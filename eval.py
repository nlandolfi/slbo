import math
import os
import sys
import subprocess

vels = {
    "HCFB": [math.inf, -math.inf, math.inf, math.inf, math.inf, math.inf, math.inf, math.inf, -math.inf, math.inf, math.inf, math.inf, math.inf, -math.inf, -math.inf, -math.inf, -math.inf, -math.inf, math.inf, -math.inf, math.inf, -math.inf, math.inf, math.inf, -math.inf, -math.inf, -math.inf, -math.inf, math.inf, math.inf, math.inf, math.inf, math.inf, math.inf, math.inf, -math.inf, math.inf, -math.inf, -math.inf, math.inf],
    "HCP": [1.621739044286087, 0.5120315517529808, 1.600031953540813, 1.3230884164208945, 0.818337879736718, 1.8390578197915646, 0.875129453163364, 1.2301006596606492, 1.9017166617863595, 0.17889633184676712, 1.9932221030952089, 1.3484648368390593, 1.1518208894213369, 0.8479821863457024, 1.1127970111023426, 0.03588457187991345, 1.525161566415382, 0.03413930365809237, 0.6481791204556626, 1.5703290150877156, 0.07574701436183395, 0.9473944477019758, 0.7762348890093063, 0.3303059755334363, 1.7210104128224775, 1.285390167914429, 1.4277798133230495, 1.4349238383912646, 0.4889460701412387, 1.2918231586056708, 0.5140048289371433, 1.530888589125165, 0.38416948358415404, 0.7301007759699705, 0.5872963834433034, 0.8579206201854694, 1.7464146092825317, 0.275386527756438, 0.00211481676132097, 1.2958350976765327],
    "HCF": [-0.730113936377963, 0.11907929481668278, -1.3543698742411587, 0.6337570297496722, -0.6265919742911406, -1.5832607528269484, 1.5481589531538384, -0.6070265000766017, 1.3763055176186398, -0.7990751875854549, -1.847517167587816, 0.6184574629125303, -1.4345230506210447, -0.24706877364398627, 1.4136736284095415, 0.4819646574378744, 1.6787233305706692, -1.3809677381145713, 0.5852122192333478, 1.153482714819555, -0.0033608023136570964, 0.8805843388572985, -1.4800964630412303, -0.0716681927457512, 0.20130410011034172, -0.9528783573529007, 1.9798937278332853, -1.7698774766039693, 1.6377186691485885, -0.3651846477902274, -0.7149272451142736, -1.3041723292904819, -1.5288256848476705, 0.04031722270744842, -1.9153102342977815, 1.7656318748338888, 0.04044230773279889, -1.3287582530024422, 1.6698433382500721, 0.03344255635917914],
    "AFB": [math.inf, -math.inf, math.inf, math.inf, math.inf, math.inf, -math.inf, math.inf, -math.inf, -math.inf, math.inf, math.inf, math.inf, math.inf, math.inf, -math.inf, -math.inf, -math.inf, math.inf, math.inf, math.inf, -math.inf, math.inf, math.inf, -math.inf, math.inf, math.inf, -math.inf, -math.inf, math.inf, math.inf, -math.inf, -math.inf, -math.inf, math.inf, -math.inf, -math.inf, -math.inf, -math.inf, math.inf],
    "AP": [0.7053388502956301, 1.2833862787089338, 2.5260050697968115, 0.8974870166302051, 0.007531547469744382, 0.5096374564521104, 1.2187510522505263, 0.1049886922212474, 2.8689360338669365, 1.6384676027462461, 1.0387508895658106, 0.6879434676873194, 0.6421632092236444, 0.42283264082528504, 1.4857185257156393, 1.7435905569754317, 0.6066977325531295, 2.41161165326549, 0.2240416269755785, 2.3424147557021655, 1.5577322738483514, 2.5838131067460592, 1.9558139919057878, 2.9681206206809856, 1.1468361122606208, 1.0972125353243145, 1.1954566572207752, 0.36205746198951505, 0.11832704596361898, 0.049266694609681916, 0.7028020664823245, 0.5301775734326277, 0.24798822606050064, 1.3770351847281042, 0.7436159396464881, 2.188620026743158, 1.8178631246175083, 2.131074514392589, 2.84933325663815, 1.9460722312800192],
    "AF": [-2.5571114036000893, 2.370787529734624, -1.4722178997163375, -2.5060616662640696, -2.15860358396866, -1.8334454911504532, 0.04597115185150491, 1.6251530033017243, 2.7651907046359216, 1.2524130477638717, -0.753161638680544, 0.7238729656052252, 2.5548894952603343, 1.033855607236501, 2.085872724039568, -2.45372204478803, -2.9364707418170983, 0.34690715136410466, 1.5405296236214934, 2.146126113652322, 2.995544828506352, -1.2956401167718177, 0.060096848894452215, 1.9237446411190184, -1.0366421749320838, 2.9982435751744125, 1.315294892626575, 2.85874691886284, 1.9564084836506384, -1.4542237448242639, 0.23280201896681785, 0.022090167676853234, -2.153485268123983, 0.7096707921605585, -1.000441722979282, 2.8945882455245524, -1.4754743481572015, -0.2568700734270717, -0.5468445332186187, -2.143314994126202],
}

tasks = {
    "HCFB": "/tiger/u/lando/jobs/HCFB-eval.sh",
    "HCP": "/tiger/u/lando/jobs/HCP-eval.sh",
    "HCF": "/tiger/u/lando/jobs/HCF-eval.sh",
    "AFB": "/tiger/u/lando/jobs/AFB-eval.sh",
    "AP": "/tiger/u/lando/jobs/AP-eval.sh",
    "AF": "/tiger/u/lando/jobs/AF-eval.sh"
}

def main(exp):
    if exp not in vels:
        raise Exception("Unkown eval experiment")

    jobs = []
    e = os.environ.copy()
    for vel in vels[exp]:
        if vel == math.inf:
            e["VELOCITY"] = "[.inf]"
        elif vel == -math.inf:
            e["VELOCITY"] = "[-.inf]"
        else:
            e["VELOCITY"] = f"[{vel}]"
            
        x = subprocess.run(args=["sbatch", tasks[exp], "-o", "/tiger/u/lando/jobs/slurm-%j.out"], env=e, stdout=subprocess.PIPE)
        job = int(x.stdout[-7:-1])
        jobs.append(job)
    print(jobs)


if __name__ == '__main__':
    for task in vels:
        if task not in tasks:
            raise Exception("internal error, tasks inconsistent")
    main(sys.argv[1])